=== HITL Spike Verification ===
Started: 2026-01-24T18:28:08-06:00
2026-01-24T18:28:08-06:00 [TEST] T0: Build and Start Services
2026-01-24T18:28:08-06:00 [INFO] Building Docker images...
2026-01-24T18:28:49-06:00 [INFO] Starting services (db + agent-api)...
2026-01-24T18:28:54-06:00 [INFO] Waiting for http://localhost:8095/health...
2026-01-24T18:29:00-06:00 [INFO] Service ready!
2026-01-24T18:29:00-06:00 [TEST] T0: Health Check
2026-01-24T18:29:00-06:00 [INFO] Health check PASSED
2026-01-24T18:29:00-06:00 [TEST] T1: HITL Invoke (transition_deal)
2026-01-24T18:29:03-06:00 [INFO] HITL invoke PASSED - awaiting_approval returned
2026-01-24T18:29:03-06:00 [INFO] Approval ID: 1de2a5e5-d128-40f6-b5c7-eafccaec5517
2026-01-24T18:29:03-06:00 [INFO] Thread ID: 922f2944-bfcd-4833-a8e6-d4320465d477
2026-01-24T18:29:03-06:00 [INFO] Tool: transition_deal
2026-01-24T18:29:03-06:00 [INFO] Tool name check PASSED
2026-01-24T18:29:03-06:00 [TEST] T2: DB Invariants Check
2026-01-24T18:29:03-06:00 [INFO] DB invariants written to ./gate_artifacts/db_invariants.sql.out
2026-01-24T18:29:03-06:00 [TEST] T3: Approve Happy Path
2026-01-24T18:29:03-06:00 [INFO] Approve PASSED (HTTP 200, status=completed per MDv2)
2026-01-24T18:29:03-06:00 [TEST] T4: Double-Approve Idempotency
2026-01-24T18:29:03-06:00 [INFO] Double-approve correctly rejected (HTTP 409)
2026-01-24T18:29:03-06:00 [TEST] T6: Kill-9 Crash Recovery
2026-01-24T18:29:03-06:00 [INFO] Creating new pending approval for crash test...
2026-01-24T18:29:05-06:00 [INFO] Pending approval created: 9d443615-800a-4850-b1c8-2f001a2989ce
2026-01-24T18:29:05-06:00 [INFO] Killing container with SIGKILL...
2026-01-24T18:29:06-06:00 [INFO] Restarting container...
2026-01-24T18:29:07-06:00 [INFO] Waiting for http://localhost:8095/health...
2026-01-24T18:29:11-06:00 [INFO] Service ready!
2026-01-24T18:29:11-06:00 [INFO] Verifying approval survived crash...
2026-01-24T18:29:11-06:00 [INFO] Crash recovery PASSED - approval survived
2026-01-24T18:29:11-06:00 [TEST] T5: Concurrent Approvals (N=20)
2026-01-24T18:29:13-06:00 [INFO] Concurrent test approval: cba343ba-fd71-491e-bc1c-4d5b665e0be3
2026-01-24T18:29:13-06:00 [INFO] Sending 20 parallel approve requests...
2026-01-24T18:29:13-06:00 [INFO] Concurrent results: 200=1, 409=19, 400=0
0
2026-01-24T18:29:13-06:00 [INFO] Concurrent test PASSED - exactly 1 winner
2026-01-24T18:29:13-06:00 [TEST] T8: Tool Arg Validation (extra=forbid)
2026-01-24T18:29:13-06:00 [INFO] Tool arg validation PASSED
2026-01-24T18:29:13-06:00 [TEST] T9: Dependency License Report
2026-01-24T18:29:14-06:00 [INFO] License report generated: 146 packages
2026-01-24T18:29:14-06:00 [TEST] T9b: Copyleft License Gate
2026-01-24T18:29:14-06:00 [INFO] Copyleft gate PASSED: no GPL/AGPL/LGPL detected
2026-01-24T18:29:14-06:00 [TEST] T10: Audit Log Verification
2026-01-24T18:29:14-06:00 [INFO] Audit log verification written to ./gate_artifacts/db_invariants.sql.out
2026-01-24T18:29:14-06:00 [TEST] T11: Mock Safety Check
2026-01-24T18:29:14-06:00 [INFO] Mock safety check PASSED
2026-01-24T18:29:14-06:00 [TEST] T12: Streaming (SSE) Test
2026-01-24T18:29:15-06:00 [INFO] Streaming gate PASSED
2026-01-24T18:29:15-06:00 [TEST] T13: HITL Scope Test
2026-01-24T18:29:15-06:00 [INFO] HITL scope test PASSED
2026-01-24T18:29:15-06:00 [TEST] T14: Auth Negative Tests (JWT Enforcement)
2026-01-24T18:29:17-06:00 [INFO] Auth test approval created: f88a1c19-7482-4b23-874b-1baae7509df1
2026-01-24T18:29:17-06:00 [INFO] Generated auth test tokens
2026-01-24T18:29:17-06:00 [INFO] Restarting container with JWT enforcement...
2026-01-24T18:29:28-06:00 [INFO] Waiting for http://localhost:8095/health...
2026-01-24T18:29:28-06:00 [INFO] Service ready!
2026-01-24T18:29:28-06:00 [INFO] Auth negative tests: 7/7 passed
2026-01-24T18:29:28-06:00 [INFO]   no_token: 401 (expect 401)
2026-01-24T18:29:28-06:00 [INFO]   expired: 401 (expect 401)
2026-01-24T18:29:28-06:00 [INFO]   wrong_iss: 401 (expect 401)
2026-01-24T18:29:28-06:00 [INFO]   wrong_aud: 401 (expect 401)
2026-01-24T18:29:28-06:00 [INFO]   missing_role_claim: 401 (expect 401 per Decision Lock ยง7)
2026-01-24T18:29:28-06:00 [INFO]   insufficient_role: 403 (expect 403 per Decision Lock ยง7)
2026-01-24T18:29:28-06:00 [INFO]   valid: 200 (expect 200/409)
2026-01-24T18:29:28-06:00 [INFO] Restoring container without JWT enforcement...
2026-01-24T18:29:32-06:00 [INFO] Waiting for http://localhost:8095/health...
2026-01-24T18:29:34-06:00 [INFO] Service ready!
2026-01-24T18:29:34-06:00 [TEST] SUMMARY
2026-01-24T18:29:34-06:00 [INFO] Running hard gate checks...
2026-01-24T18:29:34-06:00 [INFO] Auth negative gate PASSED (7/7)
2026-01-24T18:29:34-06:00 [INFO] Streaming gate PASSED
2026-01-24T18:29:34-06:00 [INFO] Copyleft gate PASSED (no GPL/AGPL/LGPL)
2026-01-24T18:29:34-06:00 [INFO] HITL scope gate PASSED
2026-01-24T18:29:34-06:00 [INFO] Tool arg validation gate PASSED
2026-01-24T18:29:34-06:00 [INFO] Final health check...
2026-01-24T18:29:34-06:00 [INFO] Final health: PASSED
Completed: 2026-01-24T18:29:34-06:00
2026-01-24T18:29:34-06:00 [INFO] ==========================================
2026-01-24T18:29:34-06:00 [INFO] BASELINE GATES PASSED - HITL Spike verified!
2026-01-24T18:29:34-06:00 [INFO] ==========================================
2026-01-24T18:29:34-06:00 [INFO] Running Phase 0 + Phase 1 gates...
2026-01-24T18:29:43-06:00 [INFO] Phase 0 + Phase 1 gates completed
2026-01-24T18:29:43-06:00 [INFO] Running Phase 2/4/5 gates...
2026-01-24T18:29:59-06:00 [INFO] Phase 2/4/5 gates completed
2026-01-24T18:29:59-06:00 [INFO] Running Phase 6/7/8 gates (Production Readiness)...
2026-01-24T18:30:00-06:00 [INFO] Phase 6/7/8 gates completed
2026-01-24T18:30:00-06:00 [INFO] ==========================================
2026-01-24T18:30:00-06:00 [INFO] ALL GATES COMPLETED
2026-01-24T18:30:00-06:00 [INFO] ==========================================
