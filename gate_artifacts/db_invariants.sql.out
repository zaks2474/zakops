=== DB Invariants ===
Timestamp: 2026-01-24T17:01:33-06:00

-- Approval row (id=c7cc498c-4191-425a-9d26-8f3dd2ea69c1)
                  id                  |    tool_name    | status  |                                                    idempotency_key                                                    |          created_at           |          expires_at           
--------------------------------------+-----------------+---------+-----------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 c7cc498c-4191-425a-9d26-8f3dd2ea69c1 | transition_deal | pending | 7d81ceba-a5c9-4558-8554-e888f43aeb81:transition_deal:f33e0e594f304a5f1fa8d31ae655a1d3f36dc1de5a88350560844b8e3871646e | 2026-01-24 23:01:33.559274+00 | 2026-01-25 00:01:33.555611+00
(1 row)


-- All pending approvals
                  id                  |    tool_name    | status  |          created_at           
--------------------------------------+-----------------+---------+-------------------------------
 e0b0bea7-baae-42aa-ba3f-aa73b4dd5880 | transition_deal | pending | 2026-01-23 16:18:32.733554+00
 73cc8d20-27b1-4df3-bca9-0ac06622bb8a | transition_deal | pending | 2026-01-23 16:18:34.67289+00
 b647672c-dcb4-4b09-8ed2-a35267d91d93 | transition_deal | pending | 2026-01-23 16:18:36.146147+00
 cab1ffac-8930-4a57-a128-c5d8f924f445 | transition_deal | pending | 2026-01-23 16:21:21.296713+00
 8b128682-c5f3-4534-9157-6167ec932f29 | transition_deal | pending | 2026-01-23 16:21:23.611397+00
 460e1977-2b56-4c91-92fc-d48debcccb1a | transition_deal | pending | 2026-01-23 16:21:28.37762+00
 a6ec13eb-d304-413d-8d2f-f6ef739b0520 | transition_deal | pending | 2026-01-23 16:40:31.567747+00
 7fbb8aee-0c68-4b3c-a4d6-994574024503 | transition_deal | pending | 2026-01-23 17:16:52.95346+00
 ca7c84d0-b92d-4c9b-ab31-15f0c3ff28d3 | transition_deal | pending | 2026-01-23 17:20:53.786089+00
 c7cc498c-4191-425a-9d26-8f3dd2ea69c1 | transition_deal | pending | 2026-01-24 23:01:33.559274+00
(10 rows)


-- Checkpoint tables exist (checkpoints, checkpoint_writes, checkpoint_blobs)
 checkpoints | checkpoint_writes | checkpoint_blobs 
-------------+-------------------+------------------
 checkpoints | checkpoint_writes | checkpoint_blobs
(1 row)


-- Checkpoint count
 checkpoint_count 
------------------
              288
(1 row)


-- Checkpoint blobs count (if table exists)
 blob_count 
------------
        456
(1 row)


-- Idempotency key uniqueness check (should be 0 duplicates)
 idempotency_key | cnt 
-----------------+-----
(0 rows)


-- Audit log for approval c7cc498c-4191-425a-9d26-8f3dd2ea69c1
        event_type        |  actor_id  |          created_at           
--------------------------+------------+-------------------------------
 approval_claimed         | approver-1 | 2026-01-24 23:01:34.076915+00
 tool_execution_started   | approver-1 | 2026-01-24 23:01:34.087777+00
 tool_execution_completed | approver-1 | 2026-01-24 23:01:34.10056+00
 approval_approved        | approver-1 | 2026-01-24 23:01:34.100621+00
(4 rows)


-- Tool executions for concurrent test
 execution_count 
-----------------
               1
(1 row)


=== Audit Log Verification ===
Timestamp: 2026-01-24T17:01:44-06:00

-- Audit log event counts by type
        event_type        | cnt 
--------------------------+-----
 tool_execution_completed |  60
 approval_claimed         |  60
 tool_execution_started   |  60
 approval_approved        |  60
(4 rows)


-- Recent audit events (last 20)
                  id                  |        event_type        |     actor_id      |             approval_id              |          created_at           
--------------------------------------+--------------------------+-------------------+--------------------------------------+-------------------------------
 c2a3ce1b-d755-4af7-8ac9-42abec7dd883 | approval_approved        | approver-3        | 569f259f-463b-47f9-8987-01a128d3dd4a | 2026-01-24 23:01:43.377491+00
 a60fbb52-8bc2-4798-acf5-a7af6eeaaa50 | tool_execution_completed | approver-3        | 569f259f-463b-47f9-8987-01a128d3dd4a | 2026-01-24 23:01:43.377427+00
 6623efff-7a31-4634-a006-df0232822cdb | tool_execution_started   | approver-3        | 569f259f-463b-47f9-8987-01a128d3dd4a | 2026-01-24 23:01:43.312988+00
 71cbfdf4-e364-49e8-984d-f00507d038de | approval_claimed         | approver-3        | 569f259f-463b-47f9-8987-01a128d3dd4a | 2026-01-24 23:01:43.305223+00
 fbbec40f-6aba-4f49-a4c3-2e1d08c37a00 | approval_approved        | recovery-approver | f4e93016-b9e1-4ceb-a9cf-76684406e450 | 2026-01-24 23:01:41.371081+00
 f550e8bf-b75b-4d17-91c8-23633063045a | tool_execution_completed | recovery-approver | f4e93016-b9e1-4ceb-a9cf-76684406e450 | 2026-01-24 23:01:41.371016+00
 9b8a8231-8d88-4157-8c2a-923ef7739620 | tool_execution_started   | recovery-approver | f4e93016-b9e1-4ceb-a9cf-76684406e450 | 2026-01-24 23:01:41.338554+00
 88b2398a-5e12-478d-86c8-3d0300c1ac15 | approval_claimed         | recovery-approver | f4e93016-b9e1-4ceb-a9cf-76684406e450 | 2026-01-24 23:01:41.327366+00
 1a5a7509-fe5d-472d-958f-fd94ec4ce92f | approval_approved        | approver-1        | c7cc498c-4191-425a-9d26-8f3dd2ea69c1 | 2026-01-24 23:01:34.100621+00
 5e857073-b1a9-476a-bfac-d6cc2d20a999 | tool_execution_completed | approver-1        | c7cc498c-4191-425a-9d26-8f3dd2ea69c1 | 2026-01-24 23:01:34.10056+00
 579a2f7b-622f-4bd5-9a30-b0322ba1200a | tool_execution_started   | approver-1        | c7cc498c-4191-425a-9d26-8f3dd2ea69c1 | 2026-01-24 23:01:34.087777+00
 4859dd0c-a5b8-4072-8968-923252f34032 | approval_claimed         | approver-1        | c7cc498c-4191-425a-9d26-8f3dd2ea69c1 | 2026-01-24 23:01:34.076915+00
 8472cbdd-7af0-4cd2-8cbb-cdb86b857086 | approval_approved        | test-user         | ab394fb0-cd3f-4e2b-a313-3200cbb0842d | 2026-01-24 22:58:56.776466+00
 84385c09-f0cc-4705-a112-861201e52933 | tool_execution_completed | test-user         | ab394fb0-cd3f-4e2b-a313-3200cbb0842d | 2026-01-24 22:58:56.7764+00
 26f649e7-fcf1-4040-becd-153882038799 | tool_execution_started   | test-user         | ab394fb0-cd3f-4e2b-a313-3200cbb0842d | 2026-01-24 22:58:56.741557+00
 c16204be-90c3-4251-9465-5f6bcc4c995e | approval_claimed         | test-user         | ab394fb0-cd3f-4e2b-a313-3200cbb0842d | 2026-01-24 22:58:56.726632+00
 6a05d41f-9617-4a1d-af11-e0147687d0cf | approval_approved        | approver-1        | 033953e9-6932-4e61-9ca8-f0bbd8e28201 | 2026-01-24 22:58:39.839998+00
 3fc172b6-51fb-45f1-9d10-612e18944f70 | tool_execution_completed | approver-1        | 033953e9-6932-4e61-9ca8-f0bbd8e28201 | 2026-01-24 22:58:39.839932+00
 617aa7fa-52f9-4ee4-853c-4948be131dfc | tool_execution_started   | approver-1        | 033953e9-6932-4e61-9ca8-f0bbd8e28201 | 2026-01-24 22:58:39.779317+00
 79176200-7c9a-494d-8e19-79e0fbd92bc8 | approval_claimed         | approver-1        | 033953e9-6932-4e61-9ca8-f0bbd8e28201 | 2026-01-24 22:58:39.772638+00
(20 rows)


-- Audit trail completeness check (approvals should have matching audit events)
             approval_id              | approval_status | audit_event_count |                                        events                                         
--------------------------------------+-----------------+-------------------+---------------------------------------------------------------------------------------
 569f259f-463b-47f9-8987-01a128d3dd4a | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 f4e93016-b9e1-4ceb-a9cf-76684406e450 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 c7cc498c-4191-425a-9d26-8f3dd2ea69c1 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 ab394fb0-cd3f-4e2b-a313-3200cbb0842d | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 033953e9-6932-4e61-9ca8-f0bbd8e28201 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 3ecf74bc-6d58-4c49-ae83-264b7acef929 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 e9f0552f-efb3-420e-9c5b-84c368254ede | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 249f043d-2e17-4696-b0a2-f66284ca1f07 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 49f79c16-9afa-4741-b60c-0c0b5546264e | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 88a3e097-2335-48b3-816c-a8fdf062defd | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
(10 rows)

