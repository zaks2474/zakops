=== DB Invariants ===
Timestamp: 2026-01-24T14:46:25-06:00

-- Approval row (id=7453b613-6e9e-46d1-af6c-15abcaf2e8fd)
                  id                  |    tool_name    | status  |                                                    idempotency_key                                                    |          created_at           |          expires_at           
--------------------------------------+-----------------+---------+-----------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 7453b613-6e9e-46d1-af6c-15abcaf2e8fd | transition_deal | pending | add7ff67-610a-42e4-bdcf-e7523de83774:transition_deal:f33e0e594f304a5f1fa8d31ae655a1d3f36dc1de5a88350560844b8e3871646e | 2026-01-24 20:46:25.788934+00 | 2026-01-24 21:46:25.785355+00
(1 row)


-- All pending approvals
                  id                  |    tool_name    | status  |          created_at           
--------------------------------------+-----------------+---------+-------------------------------
 e0b0bea7-baae-42aa-ba3f-aa73b4dd5880 | transition_deal | pending | 2026-01-23 16:18:32.733554+00
 73cc8d20-27b1-4df3-bca9-0ac06622bb8a | transition_deal | pending | 2026-01-23 16:18:34.67289+00
 b647672c-dcb4-4b09-8ed2-a35267d91d93 | transition_deal | pending | 2026-01-23 16:18:36.146147+00
 cab1ffac-8930-4a57-a128-c5d8f924f445 | transition_deal | pending | 2026-01-23 16:21:21.296713+00
 8b128682-c5f3-4534-9157-6167ec932f29 | transition_deal | pending | 2026-01-23 16:21:23.611397+00
 460e1977-2b56-4c91-92fc-d48debcccb1a | transition_deal | pending | 2026-01-23 16:21:28.37762+00
 a6ec13eb-d304-413d-8d2f-f6ef739b0520 | transition_deal | pending | 2026-01-23 16:40:31.567747+00
 7fbb8aee-0c68-4b3c-a4d6-994574024503 | transition_deal | pending | 2026-01-23 17:16:52.95346+00
 ca7c84d0-b92d-4c9b-ab31-15f0c3ff28d3 | transition_deal | pending | 2026-01-23 17:20:53.786089+00
 7453b613-6e9e-46d1-af6c-15abcaf2e8fd | transition_deal | pending | 2026-01-24 20:46:25.788934+00
(10 rows)


-- Checkpoint tables exist (checkpoints, checkpoint_writes, checkpoint_blobs)
 checkpoints | checkpoint_writes | checkpoint_blobs 
-------------+-------------------+------------------
 checkpoints | checkpoint_writes | checkpoint_blobs
(1 row)


-- Checkpoint count
 checkpoint_count 
------------------
              216
(1 row)


-- Checkpoint blobs count (if table exists)
 blob_count 
------------
        344
(1 row)


-- Idempotency key uniqueness check (should be 0 duplicates)
 idempotency_key | cnt 
-----------------+-----
(0 rows)


-- Audit log for approval 7453b613-6e9e-46d1-af6c-15abcaf2e8fd
        event_type        |  actor_id  |          created_at           
--------------------------+------------+-------------------------------
 approval_claimed         | approver-1 | 2026-01-24 20:46:26.344519+00
 tool_execution_started   | approver-1 | 2026-01-24 20:46:26.354899+00
 tool_execution_completed | approver-1 | 2026-01-24 20:46:26.367884+00
 approval_approved        | approver-1 | 2026-01-24 20:46:26.367945+00
(4 rows)


-- Tool executions for concurrent test
 execution_count 
-----------------
               1
(1 row)


=== Audit Log Verification ===
Timestamp: 2026-01-24T14:46:36-06:00

-- Audit log event counts by type
        event_type        | cnt 
--------------------------+-----
 tool_execution_completed |  44
 approval_claimed         |  44
 tool_execution_started   |  44
 approval_approved        |  44
(4 rows)


-- Recent audit events (last 20)
                  id                  |        event_type        |     actor_id      |             approval_id              |          created_at           
--------------------------------------+--------------------------+-------------------+--------------------------------------+-------------------------------
 1c379c49-7364-4af8-9860-ebef804e4f9a | approval_approved        | approver-1        | e43fa5a1-986d-40a8-8ae2-3692b0f7cc9c | 2026-01-24 20:46:35.49634+00
 c8cd956f-0c54-4ec0-94a7-a8b9e7c84832 | tool_execution_completed | approver-1        | e43fa5a1-986d-40a8-8ae2-3692b0f7cc9c | 2026-01-24 20:46:35.49628+00
 0334ddbd-2ab9-45b3-b901-a0e891d21b9a | tool_execution_started   | approver-1        | e43fa5a1-986d-40a8-8ae2-3692b0f7cc9c | 2026-01-24 20:46:35.435342+00
 5a8e0420-1a94-4c31-ba3d-42a96cdc2634 | approval_claimed         | approver-1        | e43fa5a1-986d-40a8-8ae2-3692b0f7cc9c | 2026-01-24 20:46:35.428176+00
 25ccd15f-05e0-41fd-88c8-754b79e74bf8 | approval_approved        | recovery-approver | d517942b-bba7-4bd4-9c01-8ca93496e0db | 2026-01-24 20:46:33.450614+00
 c5e7bb07-d4c3-4526-8bcb-e2eea183fd3b | tool_execution_completed | recovery-approver | d517942b-bba7-4bd4-9c01-8ca93496e0db | 2026-01-24 20:46:33.450554+00
 9aa4478b-3b0a-461d-a9c8-68c1d28ea216 | tool_execution_started   | recovery-approver | d517942b-bba7-4bd4-9c01-8ca93496e0db | 2026-01-24 20:46:33.418805+00
 7f2b5c42-575e-44c4-aff6-ead2f293a56c | approval_claimed         | recovery-approver | d517942b-bba7-4bd4-9c01-8ca93496e0db | 2026-01-24 20:46:33.408708+00
 90b8b757-45bd-486d-99f4-1e42f815ae8f | approval_approved        | approver-1        | 7453b613-6e9e-46d1-af6c-15abcaf2e8fd | 2026-01-24 20:46:26.367945+00
 819ac4df-1039-48dd-a54b-a70d565d81f9 | tool_execution_completed | approver-1        | 7453b613-6e9e-46d1-af6c-15abcaf2e8fd | 2026-01-24 20:46:26.367884+00
 2e326d8c-a7c7-4328-b1d7-1e94e7eb15ed | tool_execution_started   | approver-1        | 7453b613-6e9e-46d1-af6c-15abcaf2e8fd | 2026-01-24 20:46:26.354899+00
 9c6ff8d5-d6c4-4f02-98f6-ffa61c13e72b | approval_claimed         | approver-1        | 7453b613-6e9e-46d1-af6c-15abcaf2e8fd | 2026-01-24 20:46:26.344519+00
 b446d36f-947f-4fc4-94b4-f6a0ed0167ec | approval_approved        | test-user         | b6c9bd40-027d-473d-8f39-3bec12747149 | 2026-01-24 20:44:11.903262+00
 58946182-1741-47c4-bb9c-478b7d07b471 | tool_execution_completed | test-user         | b6c9bd40-027d-473d-8f39-3bec12747149 | 2026-01-24 20:44:11.903197+00
 e1410ce1-4048-4299-8749-8ef115b69e8c | tool_execution_started   | test-user         | b6c9bd40-027d-473d-8f39-3bec12747149 | 2026-01-24 20:44:11.870164+00
 897ee0e5-cf57-4587-9f60-ffd7ba813cd5 | approval_claimed         | test-user         | b6c9bd40-027d-473d-8f39-3bec12747149 | 2026-01-24 20:44:11.852299+00
 37fb0eb3-e549-405b-ab2f-bcba7933f206 | approval_approved        | approver-2        | b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | 2026-01-24 20:43:57.914187+00
 4ef2aa78-00d1-4043-bcdc-690180a765f3 | tool_execution_completed | approver-2        | b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | 2026-01-24 20:43:57.914126+00
 818ee524-e4a0-4388-b9da-125c509c2395 | tool_execution_started   | approver-2        | b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | 2026-01-24 20:43:57.85909+00
 57feb30a-28f8-4e86-b45a-80a623822e47 | approval_claimed         | approver-2        | b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | 2026-01-24 20:43:57.851857+00
(20 rows)


-- Audit trail completeness check (approvals should have matching audit events)
             approval_id              | approval_status | audit_event_count |                                        events                                         
--------------------------------------+-----------------+-------------------+---------------------------------------------------------------------------------------
 e43fa5a1-986d-40a8-8ae2-3692b0f7cc9c | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 d517942b-bba7-4bd4-9c01-8ca93496e0db | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 7453b613-6e9e-46d1-af6c-15abcaf2e8fd | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 b6c9bd40-027d-473d-8f39-3bec12747149 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 3375e5bd-dfa6-47e4-be83-923cdebf4ea7 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 e771cc10-8735-4e54-a680-f26d641b9d88 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 6fc0f1e8-b8ad-4a4e-a3e4-02ee482b77a0 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 6d158eb4-d4da-404e-a05c-9da4f7fdd66d | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 cdedfbac-40d5-4daa-a579-006bf63186e5 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
(10 rows)

