=== DB Invariants ===
Timestamp: 2026-01-24T17:44:01-06:00

-- Approval row (id=a1739b37-eff7-4ee5-83cc-83c6316f52e5)
                  id                  |    tool_name    | status  |                                                    idempotency_key                                                    |          created_at           |          expires_at           
--------------------------------------+-----------------+---------+-----------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 a1739b37-eff7-4ee5-83cc-83c6316f52e5 | transition_deal | pending | 47d10311-112b-419d-9ffd-ea8680b01965:transition_deal:f33e0e594f304a5f1fa8d31ae655a1d3f36dc1de5a88350560844b8e3871646e | 2026-01-24 23:44:01.126185+00 | 2026-01-25 00:44:01.122472+00
(1 row)


-- All pending approvals
                  id                  |    tool_name    | status  |          created_at           
--------------------------------------+-----------------+---------+-------------------------------
 e0b0bea7-baae-42aa-ba3f-aa73b4dd5880 | transition_deal | pending | 2026-01-23 16:18:32.733554+00
 73cc8d20-27b1-4df3-bca9-0ac06622bb8a | transition_deal | pending | 2026-01-23 16:18:34.67289+00
 b647672c-dcb4-4b09-8ed2-a35267d91d93 | transition_deal | pending | 2026-01-23 16:18:36.146147+00
 cab1ffac-8930-4a57-a128-c5d8f924f445 | transition_deal | pending | 2026-01-23 16:21:21.296713+00
 8b128682-c5f3-4534-9157-6167ec932f29 | transition_deal | pending | 2026-01-23 16:21:23.611397+00
 460e1977-2b56-4c91-92fc-d48debcccb1a | transition_deal | pending | 2026-01-23 16:21:28.37762+00
 a6ec13eb-d304-413d-8d2f-f6ef739b0520 | transition_deal | pending | 2026-01-23 16:40:31.567747+00
 7fbb8aee-0c68-4b3c-a4d6-994574024503 | transition_deal | pending | 2026-01-23 17:16:52.95346+00
 ca7c84d0-b92d-4c9b-ab31-15f0c3ff28d3 | transition_deal | pending | 2026-01-23 17:20:53.786089+00
 c82bc99c-342b-413d-b609-494e349bcc63 | transition_deal | pending | 2026-01-24 23:38:06.970555+00
 a1739b37-eff7-4ee5-83cc-83c6316f52e5 | transition_deal | pending | 2026-01-24 23:44:01.126185+00
(11 rows)


-- Checkpoint tables exist (checkpoints, checkpoint_writes, checkpoint_blobs)
 checkpoints | checkpoint_writes | checkpoint_blobs 
-------------+-------------------+------------------
 checkpoints | checkpoint_writes | checkpoint_blobs
(1 row)


-- Checkpoint count
 checkpoint_count 
------------------
              447
(1 row)


-- Checkpoint blobs count (if table exists)
 blob_count 
------------
        705
(1 row)


-- Idempotency key uniqueness check (should be 0 duplicates)
 idempotency_key | cnt 
-----------------+-----
(0 rows)


-- Audit log for approval a1739b37-eff7-4ee5-83cc-83c6316f52e5
        event_type        |  actor_id  |          created_at           
--------------------------+------------+-------------------------------
 approval_claimed         | approver-1 | 2026-01-24 23:44:01.618521+00
 tool_execution_started   | approver-1 | 2026-01-24 23:44:01.630492+00
 tool_execution_completed | approver-1 | 2026-01-24 23:44:01.642252+00
 approval_approved        | approver-1 | 2026-01-24 23:44:01.642314+00
(4 rows)


-- Tool executions for concurrent test
 execution_count 
-----------------
               1
(1 row)


=== Audit Log Verification ===
Timestamp: 2026-01-24T17:44:11-06:00

-- Audit log event counts by type
        event_type        | cnt 
--------------------------+-----
 tool_execution_completed |  92
 approval_claimed         |  92
 tool_execution_started   |  92
 approval_approved        |  92
 approval_rejected        |   4
(5 rows)


-- Recent audit events (last 20)
                  id                  |        event_type        |     actor_id      |             approval_id              |          created_at           
--------------------------------------+--------------------------+-------------------+--------------------------------------+-------------------------------
 64de1209-c2d5-4039-891e-cf484a788d02 | approval_approved        | approver-3        | 2cb48fd6-143d-4f7e-9151-c38707176122 | 2026-01-24 23:44:10.742956+00
 c87fe730-54ef-49de-8487-f40771addb64 | tool_execution_completed | approver-3        | 2cb48fd6-143d-4f7e-9151-c38707176122 | 2026-01-24 23:44:10.742848+00
 3e8fc041-5f30-41ee-8307-d76a1e9875eb | tool_execution_started   | approver-3        | 2cb48fd6-143d-4f7e-9151-c38707176122 | 2026-01-24 23:44:10.682706+00
 05c0e6bf-39b3-45f4-bfda-354ca68fd0e9 | approval_claimed         | approver-3        | 2cb48fd6-143d-4f7e-9151-c38707176122 | 2026-01-24 23:44:10.675851+00
 3922da22-4edb-493c-84bf-647bbd6e6006 | approval_approved        | recovery-approver | 946543b4-ffdf-4657-8f96-33103dadde83 | 2026-01-24 23:44:08.788635+00
 bacf31de-9c6a-4e83-8eca-639d303db131 | tool_execution_completed | recovery-approver | 946543b4-ffdf-4657-8f96-33103dadde83 | 2026-01-24 23:44:08.788571+00
 2ee9345b-06ce-43d8-8412-afe2d00b9cca | tool_execution_started   | recovery-approver | 946543b4-ffdf-4657-8f96-33103dadde83 | 2026-01-24 23:44:08.753425+00
 2cffc78f-01e2-44b8-938f-7039a558ba11 | approval_claimed         | recovery-approver | 946543b4-ffdf-4657-8f96-33103dadde83 | 2026-01-24 23:44:08.74152+00
 27de24b3-37c5-4bab-bbad-2cc1fc3f44a6 | approval_approved        | approver-1        | a1739b37-eff7-4ee5-83cc-83c6316f52e5 | 2026-01-24 23:44:01.642314+00
 7723a9a9-8c0a-4c50-85a1-b6e2cf59ea85 | tool_execution_completed | approver-1        | a1739b37-eff7-4ee5-83cc-83c6316f52e5 | 2026-01-24 23:44:01.642252+00
 ce233585-3716-47be-bc2a-8ff46521c65a | tool_execution_started   | approver-1        | a1739b37-eff7-4ee5-83cc-83c6316f52e5 | 2026-01-24 23:44:01.630492+00
 2ee453f8-b357-49ea-b040-bdfd8a021f3b | approval_claimed         | approver-1        | a1739b37-eff7-4ee5-83cc-83c6316f52e5 | 2026-01-24 23:44:01.618521+00
 222168ca-e27e-418e-8f4e-b54ec19b31b9 | approval_approved        | approver-3        | 762694f4-71cd-41ab-a137-6957c9d37560 | 2026-01-24 23:41:54.346584+00
 b348f4e7-d3d3-43cf-b546-980bf085baae | tool_execution_completed | approver-3        | 762694f4-71cd-41ab-a137-6957c9d37560 | 2026-01-24 23:41:54.346522+00
 716d6ead-ecc4-45a4-9bf4-1e693812e8f2 | tool_execution_started   | approver-3        | 762694f4-71cd-41ab-a137-6957c9d37560 | 2026-01-24 23:41:54.273554+00
 445a72e6-2f0b-46ac-9fca-80cb814e3f6c | approval_claimed         | approver-3        | 762694f4-71cd-41ab-a137-6957c9d37560 | 2026-01-24 23:41:54.261641+00
 6ed1096b-56c5-441c-9784-a5332ffb2dc6 | approval_approved        | chaos-cleanup     | 7e0677bb-969c-4ee7-8034-b3a6d9f28163 | 2026-01-24 23:41:52.275209+00
 65fb59c8-e4bd-4d38-9be5-6503215d5160 | tool_execution_completed | chaos-cleanup     | 7e0677bb-969c-4ee7-8034-b3a6d9f28163 | 2026-01-24 23:41:52.275062+00
 1cfca397-02ac-448a-8a9b-4c328fe4ef2c | tool_execution_started   | chaos-cleanup     | 7e0677bb-969c-4ee7-8034-b3a6d9f28163 | 2026-01-24 23:41:52.241754+00
 3e382984-e9c0-4452-a42a-4a4978aed4e8 | approval_claimed         | chaos-cleanup     | 7e0677bb-969c-4ee7-8034-b3a6d9f28163 | 2026-01-24 23:41:52.23046+00
(20 rows)


-- Audit trail completeness check (approvals should have matching audit events)
             approval_id              | approval_status | audit_event_count |                                        events                                         
--------------------------------------+-----------------+-------------------+---------------------------------------------------------------------------------------
 2cb48fd6-143d-4f7e-9151-c38707176122 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 946543b4-ffdf-4657-8f96-33103dadde83 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 a1739b37-eff7-4ee5-83cc-83c6316f52e5 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 762694f4-71cd-41ab-a137-6957c9d37560 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 7e0677bb-969c-4ee7-8034-b3a6d9f28163 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 f624e160-63cc-4d4c-b3f6-3b567b1ab5c8 | rejected        |                 1 | approval_rejected
 1facba13-07bf-42c1-a70a-9a44186fe0c9 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 37a17dfe-8ba8-4c04-8ba2-38a100bd65f2 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 325d066f-c4ec-4853-8a41-3a33e806245f | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 fa56fd87-4cdb-4cb6-967b-18ba853e0e64 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
(10 rows)

