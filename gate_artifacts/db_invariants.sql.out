=== DB Invariants ===
Timestamp: 2026-01-24T14:43:48-06:00

-- Approval row (id=e771cc10-8735-4e54-a680-f26d641b9d88)
                  id                  |    tool_name    | status  |                                                    idempotency_key                                                    |          created_at           |          expires_at           
--------------------------------------+-----------------+---------+-----------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 e771cc10-8735-4e54-a680-f26d641b9d88 | transition_deal | pending | f7f130f8-4026-4205-a8a9-755c8f7c43ab:transition_deal:f33e0e594f304a5f1fa8d31ae655a1d3f36dc1de5a88350560844b8e3871646e | 2026-01-24 20:43:48.291753+00 | 2026-01-24 21:43:48.288284+00
(1 row)


-- All pending approvals
                  id                  |    tool_name    | status  |          created_at           
--------------------------------------+-----------------+---------+-------------------------------
 e0b0bea7-baae-42aa-ba3f-aa73b4dd5880 | transition_deal | pending | 2026-01-23 16:18:32.733554+00
 73cc8d20-27b1-4df3-bca9-0ac06622bb8a | transition_deal | pending | 2026-01-23 16:18:34.67289+00
 b647672c-dcb4-4b09-8ed2-a35267d91d93 | transition_deal | pending | 2026-01-23 16:18:36.146147+00
 cab1ffac-8930-4a57-a128-c5d8f924f445 | transition_deal | pending | 2026-01-23 16:21:21.296713+00
 8b128682-c5f3-4534-9157-6167ec932f29 | transition_deal | pending | 2026-01-23 16:21:23.611397+00
 460e1977-2b56-4c91-92fc-d48debcccb1a | transition_deal | pending | 2026-01-23 16:21:28.37762+00
 a6ec13eb-d304-413d-8d2f-f6ef739b0520 | transition_deal | pending | 2026-01-23 16:40:31.567747+00
 7fbb8aee-0c68-4b3c-a4d6-994574024503 | transition_deal | pending | 2026-01-23 17:16:52.95346+00
 ca7c84d0-b92d-4c9b-ab31-15f0c3ff28d3 | transition_deal | pending | 2026-01-23 17:20:53.786089+00
 e771cc10-8735-4e54-a680-f26d641b9d88 | transition_deal | pending | 2026-01-24 20:43:48.291753+00
(10 rows)


-- Checkpoint tables exist (checkpoints, checkpoint_writes, checkpoint_blobs)
 checkpoints | checkpoint_writes | checkpoint_blobs 
-------------+-------------------+------------------
 checkpoints | checkpoint_writes | checkpoint_blobs
(1 row)


-- Checkpoint count
 checkpoint_count 
------------------
              198
(1 row)


-- Checkpoint blobs count (if table exists)
 blob_count 
------------
        316
(1 row)


-- Idempotency key uniqueness check (should be 0 duplicates)
 idempotency_key | cnt 
-----------------+-----
(0 rows)


-- Audit log for approval e771cc10-8735-4e54-a680-f26d641b9d88
        event_type        |  actor_id  |          created_at           
--------------------------+------------+-------------------------------
 approval_claimed         | approver-1 | 2026-01-24 20:43:48.818976+00
 tool_execution_started   | approver-1 | 2026-01-24 20:43:48.833117+00
 tool_execution_completed | approver-1 | 2026-01-24 20:43:48.84536+00
 approval_approved        | approver-1 | 2026-01-24 20:43:48.84542+00
(4 rows)


-- Tool executions for concurrent test
 execution_count 
-----------------
               1
(1 row)


=== Audit Log Verification ===
Timestamp: 2026-01-24T14:43:58-06:00

-- Audit log event counts by type
        event_type        | cnt 
--------------------------+-----
 tool_execution_completed |  40
 approval_claimed         |  40
 tool_execution_started   |  40
 approval_approved        |  40
(4 rows)


-- Recent audit events (last 20)
                  id                  |        event_type        |     actor_id      |             approval_id              |          created_at           
--------------------------------------+--------------------------+-------------------+--------------------------------------+-------------------------------
 37fb0eb3-e549-405b-ab2f-bcba7933f206 | approval_approved        | approver-2        | b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | 2026-01-24 20:43:57.914187+00
 4ef2aa78-00d1-4043-bcdc-690180a765f3 | tool_execution_completed | approver-2        | b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | 2026-01-24 20:43:57.914126+00
 818ee524-e4a0-4388-b9da-125c509c2395 | tool_execution_started   | approver-2        | b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | 2026-01-24 20:43:57.85909+00
 57feb30a-28f8-4e86-b45a-80a623822e47 | approval_claimed         | approver-2        | b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | 2026-01-24 20:43:57.851857+00
 77c0913c-34da-4fd6-ad3b-9ae28671f732 | approval_approved        | recovery-approver | 3375e5bd-dfa6-47e4-be83-923cdebf4ea7 | 2026-01-24 20:43:55.882671+00
 a8b632a5-5d61-444a-8a1b-d4b2b13e3c40 | tool_execution_completed | recovery-approver | 3375e5bd-dfa6-47e4-be83-923cdebf4ea7 | 2026-01-24 20:43:55.882607+00
 a09ecfdd-b48e-4095-864f-9d2aca5091fc | tool_execution_started   | recovery-approver | 3375e5bd-dfa6-47e4-be83-923cdebf4ea7 | 2026-01-24 20:43:55.849402+00
 fb822b7a-ac86-431e-b412-92b0927db03d | approval_claimed         | recovery-approver | 3375e5bd-dfa6-47e4-be83-923cdebf4ea7 | 2026-01-24 20:43:55.838137+00
 1bcf6c18-60d5-4b46-bf34-73437a9c2c72 | approval_approved        | approver-1        | e771cc10-8735-4e54-a680-f26d641b9d88 | 2026-01-24 20:43:48.84542+00
 bd9c8916-c6a0-4b42-ae50-5dbab6eef118 | tool_execution_completed | approver-1        | e771cc10-8735-4e54-a680-f26d641b9d88 | 2026-01-24 20:43:48.84536+00
 4c87de06-a698-4dd4-871a-4f8e4aed1ecb | tool_execution_started   | approver-1        | e771cc10-8735-4e54-a680-f26d641b9d88 | 2026-01-24 20:43:48.833117+00
 629ef623-ba95-4742-899c-9a774d01a541 | approval_claimed         | approver-1        | e771cc10-8735-4e54-a680-f26d641b9d88 | 2026-01-24 20:43:48.818976+00
 60b8470a-f273-4bfd-bbaa-98f0c318f1a1 | approval_approved        | test-user         | 6fc0f1e8-b8ad-4a4e-a3e4-02ee482b77a0 | 2026-01-24 20:41:51.888723+00
 bd1ef459-a4c8-4d2f-b07a-de6a185ee5d5 | tool_execution_completed | test-user         | 6fc0f1e8-b8ad-4a4e-a3e4-02ee482b77a0 | 2026-01-24 20:41:51.888657+00
 6aadcad4-d367-4a87-b984-ea0ceb3f355e | tool_execution_started   | test-user         | 6fc0f1e8-b8ad-4a4e-a3e4-02ee482b77a0 | 2026-01-24 20:41:51.853714+00
 c256d9d8-7d1d-4f7a-adf2-2b830bb8f3bb | approval_claimed         | test-user         | 6fc0f1e8-b8ad-4a4e-a3e4-02ee482b77a0 | 2026-01-24 20:41:51.839539+00
 4bb2456b-8f04-493d-9e45-bf31388ae8e9 | approval_approved        | approver-3        | 6d158eb4-d4da-404e-a05c-9da4f7fdd66d | 2026-01-24 20:41:36.799251+00
 ae0bcbf6-48e1-479a-999d-34565aa5f38c | tool_execution_completed | approver-3        | 6d158eb4-d4da-404e-a05c-9da4f7fdd66d | 2026-01-24 20:41:36.799182+00
 78e88bbb-5167-4359-94fa-3759d66fa580 | tool_execution_started   | approver-3        | 6d158eb4-d4da-404e-a05c-9da4f7fdd66d | 2026-01-24 20:41:36.735348+00
 1fffca30-1b8c-46df-8b21-74026c81ebc8 | approval_claimed         | approver-3        | 6d158eb4-d4da-404e-a05c-9da4f7fdd66d | 2026-01-24 20:41:36.728161+00
(20 rows)


-- Audit trail completeness check (approvals should have matching audit events)
             approval_id              | approval_status | audit_event_count |                                        events                                         
--------------------------------------+-----------------+-------------------+---------------------------------------------------------------------------------------
 b0fe8d60-fae9-43f3-ac1e-733b17f2c748 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 3375e5bd-dfa6-47e4-be83-923cdebf4ea7 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 e771cc10-8735-4e54-a680-f26d641b9d88 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 6fc0f1e8-b8ad-4a4e-a3e4-02ee482b77a0 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 6d158eb4-d4da-404e-a05c-9da4f7fdd66d | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 cdedfbac-40d5-4daa-a579-006bf63186e5 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 053810ff-241a-4463-baf0-96fc81f7f17f | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 768270ce-6d6d-4476-afd9-fb1280c553d5 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 e60faca6-d7d3-4b9f-8788-d7cd7408f083 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 e5ba82af-e09f-4115-8043-c168f079d69d | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
(10 rows)

