=== DB Invariants ===
Timestamp: 2026-01-24T18:29:03-06:00

-- Approval row (id=1de2a5e5-d128-40f6-b5c7-eafccaec5517)
                  id                  |    tool_name    | status  |                                                    idempotency_key                                                    |          created_at          |          expires_at           
--------------------------------------+-----------------+---------+-----------------------------------------------------------------------------------------------------------------------+------------------------------+-------------------------------
 1de2a5e5-d128-40f6-b5c7-eafccaec5517 | transition_deal | pending | 922f2944-bfcd-4833-a8e6-d4320465d477:transition_deal:f33e0e594f304a5f1fa8d31ae655a1d3f36dc1de5a88350560844b8e3871646e | 2026-01-25 00:29:03.23192+00 | 2026-01-25 01:29:03.227938+00
(1 row)


-- All pending approvals
                  id                  |    tool_name    | status  |          created_at           
--------------------------------------+-----------------+---------+-------------------------------
 e0b0bea7-baae-42aa-ba3f-aa73b4dd5880 | transition_deal | pending | 2026-01-23 16:18:32.733554+00
 73cc8d20-27b1-4df3-bca9-0ac06622bb8a | transition_deal | pending | 2026-01-23 16:18:34.67289+00
 b647672c-dcb4-4b09-8ed2-a35267d91d93 | transition_deal | pending | 2026-01-23 16:18:36.146147+00
 cab1ffac-8930-4a57-a128-c5d8f924f445 | transition_deal | pending | 2026-01-23 16:21:21.296713+00
 8b128682-c5f3-4534-9157-6167ec932f29 | transition_deal | pending | 2026-01-23 16:21:23.611397+00
 460e1977-2b56-4c91-92fc-d48debcccb1a | transition_deal | pending | 2026-01-23 16:21:28.37762+00
 a6ec13eb-d304-413d-8d2f-f6ef739b0520 | transition_deal | pending | 2026-01-23 16:40:31.567747+00
 7fbb8aee-0c68-4b3c-a4d6-994574024503 | transition_deal | pending | 2026-01-23 17:16:52.95346+00
 ca7c84d0-b92d-4c9b-ab31-15f0c3ff28d3 | transition_deal | pending | 2026-01-23 17:20:53.786089+00
 c82bc99c-342b-413d-b609-494e349bcc63 | transition_deal | pending | 2026-01-24 23:38:06.970555+00
 1de2a5e5-d128-40f6-b5c7-eafccaec5517 | transition_deal | pending | 2026-01-25 00:29:03.23192+00
(11 rows)


-- Checkpoint tables exist (checkpoints, checkpoint_writes, checkpoint_blobs)
 checkpoints | checkpoint_writes | checkpoint_blobs 
-------------+-------------------+------------------
 checkpoints | checkpoint_writes | checkpoint_blobs
(1 row)


-- Checkpoint count
 checkpoint_count 
------------------
              546
(1 row)


-- Checkpoint blobs count (if table exists)
 blob_count 
------------
        861
(1 row)


-- Idempotency key uniqueness check (should be 0 duplicates)
 idempotency_key | cnt 
-----------------+-----
(0 rows)


-- Audit log for approval 1de2a5e5-d128-40f6-b5c7-eafccaec5517
        event_type        |  actor_id  |          created_at           
--------------------------+------------+-------------------------------
 approval_claimed         | approver-1 | 2026-01-25 00:29:03.787053+00
 tool_execution_started   | approver-1 | 2026-01-25 00:29:03.816693+00
 tool_execution_completed | approver-1 | 2026-01-25 00:29:03.82909+00
 approval_approved        | approver-1 | 2026-01-25 00:29:03.829157+00
(4 rows)


-- Tool executions for concurrent test
 execution_count 
-----------------
               1
(1 row)


=== Audit Log Verification ===
Timestamp: 2026-01-24T18:29:14-06:00

-- Audit log event counts by type
        event_type        | cnt 
--------------------------+-----
 tool_execution_completed | 113
 approval_claimed         | 113
 tool_execution_started   | 113
 approval_approved        | 113
 approval_rejected        |   7
(5 rows)


-- Recent audit events (last 20)
                  id                  |        event_type        |     actor_id      |             approval_id              |          created_at           
--------------------------------------+--------------------------+-------------------+--------------------------------------+-------------------------------
 7b3c2915-8a7b-4ef4-bdaa-53017c84eb9d | approval_approved        | approver-4        | cba343ba-fd71-491e-bc1c-4d5b665e0be3 | 2026-01-25 00:29:13.266174+00
 76933967-200d-4017-8068-627c32136c96 | tool_execution_completed | approver-4        | cba343ba-fd71-491e-bc1c-4d5b665e0be3 | 2026-01-25 00:29:13.266108+00
 e0201a9a-44bf-4154-b2e3-dc0fc9303d41 | tool_execution_started   | approver-4        | cba343ba-fd71-491e-bc1c-4d5b665e0be3 | 2026-01-25 00:29:13.174632+00
 b2bcc415-8f54-41cf-817c-9a95814a6d7e | approval_claimed         | approver-4        | cba343ba-fd71-491e-bc1c-4d5b665e0be3 | 2026-01-25 00:29:13.16321+00
 4c07a24f-4fe4-4b1d-a1f7-6d66f7b24387 | approval_approved        | recovery-approver | 9d443615-800a-4850-b1c8-2f001a2989ce | 2026-01-25 00:29:11.174375+00
 7ee4e285-1aa8-407a-944f-2f2773fd7f31 | tool_execution_completed | recovery-approver | 9d443615-800a-4850-b1c8-2f001a2989ce | 2026-01-25 00:29:11.174315+00
 bb35b8e8-c14f-4e99-bf9e-c3d74bf0f241 | tool_execution_started   | recovery-approver | 9d443615-800a-4850-b1c8-2f001a2989ce | 2026-01-25 00:29:11.140577+00
 8c5e5651-a12a-4dab-8972-5d4d89a0a795 | approval_claimed         | recovery-approver | 9d443615-800a-4850-b1c8-2f001a2989ce | 2026-01-25 00:29:11.129578+00
 b48cb20f-0123-4d77-b6d8-2b0a461c94bd | approval_approved        | approver-1        | 1de2a5e5-d128-40f6-b5c7-eafccaec5517 | 2026-01-25 00:29:03.829157+00
 ea6da366-0514-4e01-9f61-73504149965a | tool_execution_completed | approver-1        | 1de2a5e5-d128-40f6-b5c7-eafccaec5517 | 2026-01-25 00:29:03.82909+00
 d50e021e-e66f-4e7f-b2ca-4b299f0bbb7a | tool_execution_started   | approver-1        | 1de2a5e5-d128-40f6-b5c7-eafccaec5517 | 2026-01-25 00:29:03.816693+00
 965b7fba-088a-43bc-9164-545b868181f8 | approval_claimed         | approver-1        | 1de2a5e5-d128-40f6-b5c7-eafccaec5517 | 2026-01-25 00:29:03.787053+00
 7508307f-b370-426b-a638-172a98ca91d1 | approval_approved        | approver-2        | 2754b9d8-83bb-4a23-8405-51ca42e77460 | 2026-01-25 00:26:46.820311+00
 a3afd3e5-a4d8-449d-9703-e78aa456436a | tool_execution_completed | approver-2        | 2754b9d8-83bb-4a23-8405-51ca42e77460 | 2026-01-25 00:26:46.820245+00
 d5e619d5-2b76-4f9f-8875-5ab1b1c9e777 | tool_execution_started   | approver-2        | 2754b9d8-83bb-4a23-8405-51ca42e77460 | 2026-01-25 00:26:46.737133+00
 c10ec02d-2721-4251-9467-ee98afd9c6cc | approval_claimed         | approver-2        | 2754b9d8-83bb-4a23-8405-51ca42e77460 | 2026-01-25 00:26:46.724189+00
 7f5f7d70-6dd9-4ffe-b583-6947e54aae4d | approval_approved        | chaos-cleanup     | ccb1d0d3-1f7e-4beb-906b-582b0f1e3e7f | 2026-01-25 00:26:44.805509+00
 61b5c5e3-6d06-484e-869e-151ce25e2d9a | tool_execution_completed | chaos-cleanup     | ccb1d0d3-1f7e-4beb-906b-582b0f1e3e7f | 2026-01-25 00:26:44.805445+00
 012dd9ce-34ac-43fd-8391-c84c4453098e | tool_execution_started   | chaos-cleanup     | ccb1d0d3-1f7e-4beb-906b-582b0f1e3e7f | 2026-01-25 00:26:44.75133+00
 4ed04102-c1b5-4709-9fc1-4d07e084a2f9 | approval_claimed         | chaos-cleanup     | ccb1d0d3-1f7e-4beb-906b-582b0f1e3e7f | 2026-01-25 00:26:44.740034+00
(20 rows)


-- Audit trail completeness check (approvals should have matching audit events)
             approval_id              | approval_status | audit_event_count |                                        events                                         
--------------------------------------+-----------------+-------------------+---------------------------------------------------------------------------------------
 cba343ba-fd71-491e-bc1c-4d5b665e0be3 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 9d443615-800a-4850-b1c8-2f001a2989ce | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 1de2a5e5-d128-40f6-b5c7-eafccaec5517 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 2754b9d8-83bb-4a23-8405-51ca42e77460 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 ccb1d0d3-1f7e-4beb-906b-582b0f1e3e7f | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 070a98c0-64b1-4d72-9cc2-adaa46522b73 | rejected        |                 1 | approval_rejected
 daf2f98f-2df8-4d75-bb8f-821e507bad27 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 f79942b4-07b5-493e-a3f0-102e9d6802d8 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 a3d12a83-ec43-48e3-b2fc-c9065eacd97b | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
 caca6684-4811-49f3-8e23-79a55e384674 | approved        |                 4 | approval_claimed, tool_execution_started, tool_execution_completed, approval_approved
(10 rows)

